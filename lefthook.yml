# Lefthook configuration for segnomms
# See https://github.com/evilmartians/lefthook for more information

pre-commit:
  parallel: true
  commands:
    # GitHub Actions linting
    actionlint:
      glob: ".github/workflows/*.{yml,yaml}"
      run: actionlint {staged_files}
      
    # Python code formatting - Black
    black:
      glob: "*.py"
      run: black --check {staged_files}
      
    # Python import sorting - isort
    isort:
      glob: "*.py"
      run: isort --check-only --profile black {staged_files}
      
    # Python linting - Flake8
    flake8:
      glob: "*.py"
      run: flake8 --max-line-length=88 --extend-ignore=E203,W503 {staged_files}
      
    # General file checks
    trailing-whitespace:
      run: |
        for file in {staged_files}; do
          if grep -q '[[:space:]]$' "$file"; then
            echo "Trailing whitespace found in $file"
            exit 1
          fi
        done
        
    end-of-file:
      run: |
        for file in {staged_files}; do
          if [ -n "$(tail -c 1 "$file")" ]; then
            echo "No newline at end of file: $file"
            exit 1
          fi
        done
        
    check-yaml:
      glob: "*.{yml,yaml}"
      exclude: ".github/workflows/*.{yml,yaml}"
      run: |
        for file in {staged_files}; do
          python -c "import yaml; yaml.safe_load(open('$file'))" || exit 1
        done
        
    check-json:
      glob: "*.json"
      run: |
        for file in {staged_files}; do
          python -m json.tool "$file" > /dev/null || exit 1
        done
        
    check-merge-conflict:
      run: |
        for file in {staged_files}; do
          if grep -E '^[<>|=]{7}' "$file"; then
            echo "Merge conflict markers found in $file"
            exit 1
          fi
        done
        
    debug-statements:
      glob: "*.py"
      run: |
        for file in {staged_files}; do
          if grep -E '(import pdb|pdb\.set_trace\(\)|import ipdb|ipdb\.set_trace\(\))' "$file"; then
            echo "Debug statements found in $file"
            exit 1
          fi
        done

# Optional: Type checking (uncomment to enable)
# pre-commit:
#   commands:
#     mypy:
#       glob: "*.py"
#       run: mypy --ignore-missing-imports {staged_files}